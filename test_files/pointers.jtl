const raw_increment = proc(value: ^int) {
    value^ = value^ + 1
}

const return_increment = proc(value: ^const int) -> int {
    return value^ + 1
}

const double_indirection = proc(value: ^const ^int) -> int {
    value^^ = value^^ * value^^
}

const main = proc() -> int {
    var a = 1
    let ap = @a
    let b = return_increment(@a) // Automatically cast pointer to mutable to pointer to const
    raw_increment(@a)
    let c = double_indirection(@ap)
    return a
}

/*
>>>
procedure None @1_raw_increment(ptr %value) {
    %5_value = alloc 8 align 8
    store ptr %value into %5_value
    %6 = load ptr %5_value
    %7 = load i32 %6
    %8 = add i32 %7, 1
    %9 = load ptr %5_value
    store i32 %8 into %9
}

procedure i32 @2_return_increment(ptr %value) {
    %10_value = alloc 8 align 8
    store ptr %value into %10_value
    %11 = load ptr %10_value
    %12 = load i32 %11
    %13 = add i32 %12, 1
    return %13
}

procedure i32 @3_double_indirection(ptr %value) {
    %14_value = alloc 8 align 8
    store ptr %value into %14_value
    %15 = load ptr %14_value
    %16 = load ptr %15
    %17 = load i32 %16
    %18 = load ptr %14_value
    %19 = load ptr %18
    %20 = load i32 %19
    %21 = mul i32 %17, %20
    %22 = load ptr %14_value
    %23 = load ptr %22
    store i32 %21 into %23
}

procedure i32 @4_main() {
    %24_a = alloc 4 align 4
    %25_ap = alloc 8 align 8
    %26_b = alloc 4 align 4
    %27_c = alloc 4 align 4
    store i32 1 into %24_a
    store ptr %24_a into %25_ap
    %28 = call i32 @2_return_increment(ptr %24_a)
    store i32 %28 into %26_b
    call @1_raw_increment(ptr %24_a)
    %29 = call i32 @3_double_indirection(ptr %25_ap)
    store i32 %29 into %27_c
    %30 = load i32 %24_a
    return %30
}

<<<
*/